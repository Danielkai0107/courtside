# å¾ªç’°è³½æ”¯æ´èªªæ˜

## å•é¡Œèˆ‡è§£æ±ºæ–¹æ¡ˆ

### å•é¡Œï¼šå¾ªç’°è³½ä¸æ”¯æ´ä½”ä½ç¬¦

**åŸå› ï¼š**
- å¾ªç’°è³½çš„å ´æ¬¡æ•¸å–æ±ºæ–¼å¯¦éš›äººæ•¸
- å…¬å¼ï¼šn Ã— (n - 1) / 2
- ä¾‹å¦‚ï¼š5äºº â†’ 10å ´ï¼Œ10äºº â†’ 45å ´
- ç„¡æ³•åœ¨å»ºç«‹è³½äº‹æ™‚é å…ˆç”Ÿæˆå›ºå®šæ•¸é‡çš„ä½”ä½ç¬¦

### è§£æ±ºæ–¹æ¡ˆï¼šå»¶é²ç”Ÿæˆ

å¾ªç’°è³½ä½¿ç”¨ã€Œå»¶é²ç”Ÿæˆã€ç­–ç•¥ï¼š
1. âœ… å»ºç«‹è³½äº‹æ™‚ï¼šä¸ç”Ÿæˆä½”ä½ç¬¦
2. âœ… å ±åæœŸé–“ï¼šé¸æ‰‹çœ‹ä¸åˆ°é è¦½ï¼ˆé€™æ˜¯åˆç†çš„ï¼‰
3. âœ… ç™¼å¸ƒè³½ç¨‹æ™‚ï¼šæ ¹æ“šå¯¦éš›äººæ•¸ç”ŸæˆçœŸå¯¦ Match

---

## æŠ€è¡“å¯¦ç¾

### æ–°å¢å‡½æ•¸ï¼šgenerateRoundRobin

```typescript
// bracketService.ts

export const generateRoundRobin = async (
  tournamentId: string,
  categoryId: string,
  participants: Array<{ id: string; name: string }>,
  ruleConfig: Match["ruleConfig"],
  courts: Array<{ id: string; name: string }>
): Promise<void> => {
  // 1. æ´—ç‰Œåƒè³½è€…
  const shuffled = shuffleArray(participants);
  
  // 2. ç”Ÿæˆæ‰€æœ‰é…å°ï¼ˆi vs jï¼‰
  for (let i = 0; i < shuffled.length; i++) {
    for (let j = i + 1; j < shuffled.length; j++) {
      // å‰µå»º Match
    }
  }
  
  // 3. åˆ†é…å ´åœ°
  // 4. æ‰¹æ¬¡å¯«å…¥
}
```

### CategoryPublisher çš„åˆ¤æ–·é‚è¼¯

```typescript
// æª¢æŸ¥æ˜¯å¦ç‚ºå¾ªç’°è³½
const isRoundRobin = 
  category.selectedFormatId?.includes("rr_") ||  // å¾ªç’°è³½æ¨¡æ¿
  (category.format === "KNOCKOUT_ONLY" && participants.length <= 5);  // å°è¦æ¨¡

if (isRoundRobin) {
  // ä½¿ç”¨å¾ªç’°è³½ç”Ÿæˆå™¨
  await generateRoundRobin(...)
} else if (category.format === "KNOCKOUT_ONLY") {
  // ä½¿ç”¨æ·˜æ±°è³½ç”Ÿæˆå™¨
  await generateKnockoutOnly(...)
} else {
  // ä½¿ç”¨å°çµ„+æ·˜æ±°è³½ç”Ÿæˆå™¨
  await generateGroupThenKnockout(...)
}
```

---

## ä½¿ç”¨æµç¨‹

### å‰µå»ºå¾ªç’°è³½è³½äº‹

```
1. Step 3: æ–°å¢åˆ†é¡
   - é¸æ“‡æ¨¡æ¿ï¼šã€Œå¾ªç’°è³½ (2-5äºº)ã€
   - é¸æ“‡è¦å‰‡ï¼šã€ŒBWFæ¨™æº–ã€
   - é€å‡º

2. Console é¡¯ç¤ºï¼š
   Round robin ä¸æ”¯æ´ä½”ä½ç¬¦ç”Ÿæˆ  â† æ­£å¸¸
   Generated 0 placeholder matches  â† æ­£å¸¸

3. é–‹æ”¾å ±å â†’ å¯©æ ¸ï¼ˆå‡è¨­ 5 äººï¼‰â†’ æˆªæ­¢å ±å

4. é€²å…¥ã€Œè³½ç¨‹ç®¡ç†ã€Tab
   - é¡¯ç¤º CategoryPublisherï¼ˆä¸æœƒé¡¯ç¤ºã€Œå·²ç™¼å¸ƒã€ï¼‰
   - é¡¯ç¤ºåƒè³½è€…ï¼š5

5. é»æ“Šã€Œç™¼å¸ƒè³½ç¨‹ã€
   Console é¡¯ç¤ºï¼š
   ğŸ¯ é–‹å§‹åˆ†é…é¸æ‰‹
   ğŸ“Š è¼‰å…¥æ¯”è³½: { totalMatches: 0 }  â† æ²’æœ‰ä½”ä½ç¬¦
   ğŸ” ä½”ä½ç¬¦ Match: { found: 0 }
   ğŸ“ æ²’æœ‰ä½”ä½ç¬¦ï¼ˆå¯èƒ½æ˜¯å¾ªç’°è³½ï¼‰
   ğŸ”§ ä½¿ç”¨æ¨™æº–ç”Ÿæˆç®—æ³•
   ğŸ”„ ç”Ÿæˆå¾ªç’°è³½
   Generated 10 round-robin matches  â† 5äººå¾ªç’° = 10å ´

6. é©—è­‰
   - é€²å…¥ CategoryDetail
   - å°é™£åœ– Tab é¡¯ç¤º 10 å ´æ¯”è³½
   - æ¯å ´éƒ½æ˜¯çœŸå¯¦é¸æ‰‹åç¨±
   - ç‹€æ…‹ç‚ºã€Œå·²æ’ç¨‹ã€
```

---

## å°æ¯”ï¼šæ·˜æ±°è³½ vs å¾ªç’°è³½

### æ·˜æ±°è³½ï¼ˆæ”¯æ´ä½”ä½ç¬¦ï¼‰

```
å»ºç«‹è³½äº‹
  â†“
ç”Ÿæˆ 15 å€‹ä½”ä½ç¬¦ Match
  â†“ (å ±åæœŸé–“)
é¸æ‰‹çœ‹åˆ°é è¦½çµæ§‹
  â†“ (ç™¼å¸ƒè³½ç¨‹)
åˆ†é…é¸æ‰‹åˆ°ä½”ä½ç¬¦
  â†“
isPlaceholder: false
```

### å¾ªç’°è³½ï¼ˆä¸æ”¯æ´ä½”ä½ç¬¦ï¼‰

```
å»ºç«‹è³½äº‹
  â†“
ä¸ç”Ÿæˆä½”ä½ç¬¦ï¼ˆå ´æ¬¡æ•¸æœªçŸ¥ï¼‰
  â†“ (å ±åæœŸé–“)
é¸æ‰‹çœ‹ä¸åˆ°é è¦½ï¼ˆåˆç†ï¼‰
  â†“ (ç™¼å¸ƒè³½ç¨‹)
ç›´æ¥ç”ŸæˆçœŸå¯¦ Match
  â†“
5äºº â†’ 10å ´æ¯”è³½
```

---

## å ´æ¬¡æ•¸è¨ˆç®—

### å¾ªç’°è³½å…¬å¼

```
å ´æ¬¡æ•¸ = n Ã— (n - 1) / 2

2äºº â†’ 1å ´
3äºº â†’ 3å ´
4äºº â†’ 6å ´
5äºº â†’ 10å ´
6äºº â†’ 15å ´
10äºº â†’ 45å ´
```

### ç‚ºä»€éº¼ä¸èƒ½é ç”Ÿæˆï¼Ÿ

```
å¦‚æœå»ºç«‹è³½äº‹æ™‚é è¨ˆ 5 äººï¼š
  â†’ ç”Ÿæˆ 10 å ´ä½”ä½ç¬¦

å¯¦éš›å ±å 6 äººï¼š
  â†’ éœ€è¦ 15 å ´ï¼ˆç„¡æ³•å¡«å…¥ 10 å€‹ä½”ä½ç¬¦ï¼‰

å¯¦éš›å ±å 3 äººï¼š
  â†’ åªéœ€ 3 å ´ï¼ˆ10 å€‹ä½”ä½ç¬¦å¤ªå¤šï¼‰
```

**çµè«–ï¼š** å¾ªç’°è³½å¿…é ˆåœ¨çŸ¥é“å¯¦éš›äººæ•¸å¾Œæ‰èƒ½ç”Ÿæˆã€‚

---

## æ¨¡æ¿å»ºè­°

### é©åˆä½”ä½ç¬¦çš„æ¨¡æ¿

- âœ… `ko_4` (4å¼·æ·˜æ±°è³½) - å›ºå®š 3 å ´
- âœ… `ko_8` (8å¼·æ·˜æ±°è³½) - å›ºå®š 7 å ´
- âœ… `ko_16` (16å¼·æ·˜æ±°è³½) - å›ºå®š 15 å ´
- âœ… `group_to_qf_13_20` (å°çµ„+8å¼·) - å›ºå®šçµæ§‹
- âœ… `group_to_semi_6_11` (å°çµ„+4å¼·) - å›ºå®šçµæ§‹

### ä¸é©åˆä½”ä½ç¬¦çš„æ¨¡æ¿

- âŒ `rr_small_2_5` (å¾ªç’°è³½) - å ´æ¬¡æ•¸å–æ±ºæ–¼äººæ•¸
  - æ”¹ç”¨å»¶é²ç”Ÿæˆ

---

## æ¸¬è©¦æª¢æŸ¥æ¸…å–®

### æ¸¬è©¦ 1: å‰µå»ºå¾ªç’°è³½

- [ ] é¸æ“‡ã€Œå¾ªç’°è³½ (2-5äºº)ã€æ¨¡æ¿
- [ ] é€å‡ºå¾Œ Console é¡¯ç¤ºï¼š
  ```
  Round robin ä¸æ”¯æ´ä½”ä½ç¬¦ç”Ÿæˆ
  Generated 0 placeholder matches
  ```
- [ ] ä¸å ±éŒ¯ï¼Œé †åˆ©å‰µå»º

### æ¸¬è©¦ 2: ç™¼å¸ƒå¾ªç’°è³½è³½ç¨‹

- [ ] å ±å 5 äººä¸¦æ‰¹å‡†
- [ ] æˆªæ­¢å ±å
- [ ] é€²å…¥ã€Œè³½ç¨‹ç®¡ç†ã€Tab
- [ ] é¡¯ç¤º CategoryPublisherï¼ˆä¸æ˜¯ã€Œå·²ç™¼å¸ƒã€ï¼‰
- [ ] é»æ“Šã€Œç™¼å¸ƒè³½ç¨‹ã€
- [ ] Console é¡¯ç¤ºï¼š
  ```
  ğŸ“ æ²’æœ‰ä½”ä½ç¬¦ï¼ˆå¯èƒ½æ˜¯å¾ªç’°è³½ï¼‰
  ğŸ”§ ä½¿ç”¨æ¨™æº–ç”Ÿæˆç®—æ³•
  ğŸ”„ ç”Ÿæˆå¾ªç’°è³½
  Generated 10 round-robin matches
  ```
- [ ] CategoryDetail é¡¯ç¤º 10 å ´æ¯”è³½
- [ ] æ¯å ´éƒ½æœ‰çœŸå¯¦é¸æ‰‹åç¨±

### æ¸¬è©¦ 3: ä¸åŒäººæ•¸

- [ ] 2äºº â†’ 1å ´
- [ ] 3äºº â†’ 3å ´
- [ ] 4äºº â†’ 6å ´
- [ ] 5äºº â†’ 10å ´

---

## å»ºè­°

### çµ¦ä¸»è¾¦æ–¹çš„æç¤º

åœ¨é¸æ“‡æ¨¡æ¿æ™‚ï¼Œå¯ä»¥åŠ å…¥èªªæ˜ï¼š

```
å¾ªç’°è³½ (2-5äºº)
â€¢ æ‰€æœ‰é¸æ‰‹äº’ç›¸å°æˆ°
â€¢ 2äººâ†’1å ´ï¼Œ5äººâ†’10å ´
â€¢ âš ï¸ ç„¡æ³•æå‰é è¦½å°æˆ°çµæ§‹
â€¢ é©åˆå°è¦æ¨¡å‹èª¼è³½
```

### UI æ”¹é€²ï¼ˆå¯é¸ï¼‰

åœ¨ CategoryDetail ä¸­ï¼Œå¦‚æœæ˜¯å¾ªç’°è³½ä¸”å°šæœªç™¼å¸ƒï¼š

```
å°é™£åœ– Tab:
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚ å¾ªç’°è³½æ¨¡å¼                  â”‚
  â”‚                            â”‚
  â”‚ âš ï¸ å¾ªç’°è³½çš„å°æˆ°çµæ§‹         â”‚
  â”‚    æœƒåœ¨ç™¼å¸ƒè³½ç¨‹æ™‚ç”Ÿæˆ       â”‚
  â”‚                            â”‚
  â”‚ ç›®å‰å·²å ±åï¼š5 äºº            â”‚
  â”‚ é è¨ˆå ´æ¬¡ï¼š10 å ´             â”‚
  â”‚                            â”‚
  â”‚ è«‹åœ¨æˆªæ­¢å ±åå¾Œåˆ°           â”‚
  â”‚ ã€Œè³½ç¨‹ç®¡ç†ã€Tab ç™¼å¸ƒè³½ç¨‹    â”‚
  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ç¸½çµ

### å¾ªç’°è³½çš„ç‰¹æ®Šæ€§

- âŒ ä¸æ”¯æ´ä½”ä½ç¬¦ï¼ˆå ´æ¬¡æ•¸ä¸å›ºå®šï¼‰
- âŒ å ±åè€…ç„¡æ³•æå‰é è¦½çµæ§‹
- âœ… ç™¼å¸ƒæ™‚ç›´æ¥ç”ŸæˆçœŸå¯¦ Match
- âœ… å®Œå…¨æ”¯æ´å±€æ•¸åˆ¶è¦å‰‡
- âœ… å®Œå…¨æ”¯æ´å ´åœ°åˆ†é…

### é©ç”¨å ´æ™¯

- âœ… 2-5äººå°è¦æ¨¡æ¯”è³½
- âœ… å‹èª¼è³½ã€ç·´ç¿’è³½
- âœ… æƒ³è®“æ¯å€‹äººéƒ½å¤šæ‰“å¹¾å ´
- âŒ å¤§è¦æ¨¡æ¯”è³½ï¼ˆæœƒç”¢ç”Ÿå¤ªå¤šå ´æ¬¡ï¼‰

---

**ä¿®å¾©æ—¥æœŸï¼š** 2024å¹´12æœˆ23æ—¥  
**ç‹€æ…‹ï¼š** âœ… å¾ªç’°è³½å®Œå…¨æ”¯æ´

