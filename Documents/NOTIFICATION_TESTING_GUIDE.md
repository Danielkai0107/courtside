# 📬 通知系統測試指南

## 實施完成項目

通知系統已完全實施，包括：

- 通知資料模型與類型定義
- 完整的通知服務層（CRUD + 即時監聽）
- 三個服務層的通知整合（報名、工作人員、賽程）
- NotificationCard 組件
- Notifications 頁面
- 底部導航整合（含未讀徽章）
- Firestore 索引配置
- Firestore 安全規則
- 路由配置

## 🎯 通知類型測試清單（14 種）

### 🏃 運動員角色通知（6 種）

#### 1. 報名錄取（REGISTRATION_APPROVED）

**觸發方式**：

1. 使用一般用戶帳號報名賽事
2. 切換到主辦方帳號
3. 進入賽事管理 → 人員管理
4. 點擊「批准」該選手的報名

**預期結果**：

- 運動員收到「報名已通過」通知
- 通知包含「查看賽事」快速操作按鈕
- 圖示：綠色勾號 (CheckCircle)

#### 2. 報名被拒（REGISTRATION_REJECTED）

**觸發方式**：

1. 使用一般用戶帳號報名賽事
2. 切換到主辦方帳號
3. 進入賽事管理 → 人員管理
4. 點擊「拒絕」該選手的報名

**預期結果**：

- 運動員收到「報名未通過」通知
- 無快速操作按鈕
- 圖示：紅色叉號 (XCircle)

#### 3. 賽程發布（SCHEDULE_PUBLISHED）

**觸發方式**：

1. 主辦方建立賽事並審核選手
2. 進入賽事管理 → 賽程管理
3. 點擊「自動抽籤」
4. 點擊「發布賽程」

**預期結果**：

- 所有已確認選手收到「賽程已發布」通知
- 通知包含「查看賽程」快速操作按鈕
- 圖示：藍色日曆 (Calendar)

#### 4. ⏸️ 比賽開始提醒（MATCH_STARTING_SOON）

**狀態**：可選功能，未實施
**實施建議**：使用 Firebase Functions 定時觸發器

#### 5. ⏸️ 比賽結果公布（MATCH_COMPLETED）

**狀態**：可選功能，未實施
**實施建議**：在 matchService 的比賽結束時觸發

#### 6. ⏸️ 賽事取消（TOURNAMENT_CANCELLED）

**狀態**：可選功能，未實施
**實施建議**：在 tournamentService 刪除賽事時觸發

---

### 🏆 主辦方角色通知（4 種）

#### 7. 新報名申請（NEW_REGISTRATION）

**觸發方式**：

1. 使用一般用戶帳號報名賽事

**預期結果**：

- 主辦方收到「新報名申請」通知
- 通知內容包含選手姓名
- 通知包含「前往審核」快速操作按鈕
- 圖示：藍色新增用戶 (UserPlus)

#### 8. 工作人員接受邀請（STAFF_ACCEPTED）

**觸發方式**：

1. 主辦方邀請紀錄員
2. 切換到紀錄員帳號
3. 在「我的任務」頁面查看邀請
4. 點擊「接受」按鈕

**預期結果**：

- 主辦方收到「工作人員已接受」通知
- 通知內容包含工作人員姓名
- 通知包含「查看工作人員」快速操作按鈕
- 圖示：綠色勾號 (CheckCircle)

#### 9. 工作人員拒絕邀請（STAFF_DECLINED）

**觸發方式**：

1. 主辦方邀請紀錄員
2. 切換到紀錄員帳號
3. 在「我的任務」頁面查看邀請
4. 點擊「拒絕」按鈕

**預期結果**：

- 主辦方收到「工作人員已拒絕」通知
- 通知內容包含工作人員姓名
- 通知包含「重新邀請」快速操作按鈕
- 圖示：紅色叉號 (XCircle)

#### 10. ⏸️ 比賽開始計分（MATCH_IN_PROGRESS）

**狀態**：可選功能，未實施
**實施建議**：在 matchService 比賽狀態變為 IN_PROGRESS 時觸發

---

### 📝 紀錄員角色通知（4 種）

#### 11. 收到工作邀請（STAFF_INVITATION）

**觸發方式**：

1. 主辦方在賽事管理中邀請紀錄員
2. 輸入已註冊用戶的 Email
3. 點擊「邀請」

**預期結果**：

- 紀錄員立即收到「收到工作邀請」通知
- 通知包含「接受」和「拒絕」兩個快速操作按鈕
- 圖示：橘色郵件 (Mail)

#### 12. ⏸️ 被分配比賽（MATCH_ASSIGNED）

**狀態**：可選功能，未實施
**實施建議**：在 matchService 設定 scorerId 時觸發

#### 13. ⏸️ 比賽即將開始（MATCH_STARTING_STAFF）

**狀態**：可選功能，未實施
**實施建議**：使用 Firebase Functions 定時觸發器

#### 14. ⏸️ 賽事取消（TOURNAMENT_CANCELLED - 紀錄員版）

**狀態**：可選功能，未實施
**實施建議**：在 tournamentService 刪除賽事時觸發

---

## 🧪 核心功能測試步驟

### 1. 通知頁面基本功能

**測試項目**：

- [ ] 點擊底部導航「通知」進入通知頁面
- [ ] 查看所有通知列表（最新在上）
- [ ] 切換「全部」和「未讀」Tab
- [ ] 未讀徽章正確顯示數量
- [ ] 點擊通知自動標記為已讀
- [ ] 點擊通知的快速操作按鈕正確導航

### 2. 未讀徽章測試

**測試項目**：

- [ ] 收到新通知時，底部導航徽章自動更新
- [ ] 標記已讀後，徽章數量減少
- [ ] 全部已讀後，徽章消失
- [ ] 徽章顯示最多 99+

### 3. 操作功能測試

**測試項目**：

- [ ] 點擊「全部已讀」能標記所有通知為已讀
- [ ] 點擊「清除已讀」能刪除所有已讀通知（需確認）
- [ ] 單個刪除通知功能正常
- [ ] 接受/拒絕邀請功能正常（紀錄員邀請通知）

### 4. 即時更新測試

**測試項目**：

- [ ] 在通知頁面時收到新通知，列表自動更新
- [ ] 未讀徽章即時更新
- [ ] 多個設備同時登入，通知同步

### 5. 三角色通用測試

**測試項目**：

- [ ] 一般用戶能看到通知選項
- [ ] 主辦方能看到通知選項
- [ ] 紀錄員能看到通知選項
- [ ] 各角色都能正常接收和查看通知

---

## 🎨 UI/UX 測試

### 通知卡片樣式

**測試項目**：

- [ ] 未讀通知有藍色左側邊線
- [ ] 已讀通知背景為淡灰色
- [ ] Hover 效果正常（陰影提升）
- [ ] 通知圖示顏色正確
- [ ] 時間格式正確（剛剛、X 分鐘前、X 小時前、日期時間）

### 空狀態

**測試項目**：

- [ ] 沒有通知時顯示空狀態
- [ ] 沒有未讀通知時顯示相應提示

### 響應式設計

**測試項目**：

- [ ] 手機版顯示正常
- [ ] 平板版顯示正常
- [ ] 桌面版顯示正常

---

## 🔒 安全性測試

**測試項目**：

- [ ] 未登入用戶無法訪問通知頁面
- [ ] 用戶只能看到自己的通知
- [ ] 用戶無法刪除他人的通知
- [ ] 通知查詢受 Firestore 規則保護

---

## 📊 實施優先級總結

### P0 - 已完成（7 種核心通知）

1.  報名錄取 (REGISTRATION_APPROVED)
2.  報名被拒 (REGISTRATION_REJECTED)
3.  賽程發布 (SCHEDULE_PUBLISHED)
4.  新報名申請 (NEW_REGISTRATION)
5.  工作人員接受邀請 (STAFF_ACCEPTED)
6.  工作人員拒絕邀請 (STAFF_DECLINED)
7.  收到工作邀請 (STAFF_INVITATION)

### ⏸️ P1/P2 - 待實施（7 種進階通知）

8. ⏸️ 比賽開始提醒 (MATCH_STARTING_SOON)
9. ⏸️ 比賽結果公布 (MATCH_COMPLETED)
10. ⏸️ 賽事取消 (TOURNAMENT_CANCELLED)
11. ⏸️ 比賽開始計分 (MATCH_IN_PROGRESS)
12. ⏸️ 被分配比賽 (MATCH_ASSIGNED)
13. ⏸️ 比賽即將開始 (MATCH_STARTING_STAFF)
14. ⏸️ 賽事取消（紀錄員版）

---

## 🚀 部署前檢查清單

**Firebase 配置**：

- [ ] 執行 `firebase deploy --only firestore:indexes` 部署索引
- [ ] 執行 `firebase deploy --only firestore:rules` 部署安全規則
- [ ] 確認索引建立完成（可能需要數分鐘）

**前端檢查**：

- [ ] `npm run build` 成功編譯
- [ ] 沒有 TypeScript 錯誤
- [ ] 沒有 ESLint 警告

**功能驗證**：

- [ ] 本地開發環境測試所有核心功能
- [ ] 多角色切換測試
- [ ] 瀏覽器開發者工具無錯誤

---

## 後續增強建議

### 短期優化

1. **通知分類篩選**

   - 新增「報名」、「賽程」、「邀請」等分類標籤
   - 允許按類型篩選通知

2. **Toast 即時提示**

   - 收到新通知時顯示 Toast 提示
   - 可點擊 Toast 直接進入通知頁面

3. **通知音效**
   - 新增可選的通知提示音
   - 用戶可在設定中開關

### 長期增強

1. **瀏覽器推播通知**

   - 整合 Firebase Cloud Messaging
   - 用戶離線時也能收到通知

2. **Email 通知整合**

   - 重要通知同時發送 Email
   - 使用現有的 emailService

3. **通知偏好設定**
   - 用戶可選擇接收哪些類型的通知
   - 免打擾模式

---

## 📝 技術文檔

### 資料模型

請參考 [`src/types/index.ts`](../src/types/index.ts) 中的 `Notification` 介面和 `NotificationType` 類型。

### 服務層 API

請參考 [`src/services/notificationService.ts`](../src/services/notificationService.ts) 中的所有函數說明。

### 通知觸發位置

- **報名相關**：[`src/services/registrationService.ts`](../src/services/registrationService.ts)
- **工作人員相關**：[`src/services/staffService.ts`](../src/services/staffService.ts)
- **賽程相關**：[`src/services/tournamentService.ts`](../src/services/tournamentService.ts)

---

**🎉 通知系統已完整實施並可投入使用！**
