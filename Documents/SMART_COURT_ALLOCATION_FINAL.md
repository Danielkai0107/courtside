# 智能場地分配 - 最終實施方案

## 🎯 最終設計

### Tab 分離與功能定位

**場地管理 Tab**（全局）：
- ✅ 新增場地
- ✅ 刪除場地
- ✅ 查看場地列表和狀態
- ❌ 不包含重新分配（移到賽程管理）

**賽程管理 Tab**（按分類）：
- ✅ 查看各分類賽程狀態
- ✅ 發布賽程（智能分配場地）
- ✅ **重新分配場地**（按當前分類）⭐

**原因**：
- 場地是全局資源
- 但分配是按分類進行的
- 每個分類應該能獨立重新分配

## 🎨 UI 結構（最終版）

### 場地管理 Tab
```
┌────────────────────────────────────┐
│ 場地管理            [+ 新增場地]   │
├────────────────────────────────────┤
│ 💡 場地用於分配比賽。建議在發布   │
│    賽程前先設定場地。新增場地後可 │
│    在「賽程管理」Tab 重新分配各分類│
│    的比賽。                        │
├────────────────────────────────────┤
│ Court 01  空閒         [刪除]     │
│ Court 02  空閒         [刪除]     │
│ Court 03  空閒         [刪除]     │
├────────────────────────────────────┤
│ 共 3 個場地                        │
└────────────────────────────────────┘
```

### 賽程管理 Tab - 已發布狀態
```
┌────────────────────────────────────┐
│ [男子雙打] [女子單打]             │
│    ↑ 選中                          │
├────────────────────────────────────┤
│ ✓  賽程已發布                     │
│    此分類的賽程已經生成並發布      │
│                                    │
│ 📅 26 場比賽                       │
│ 👥 18 支隊伍                       │
│                                    │
│ [🔄 重新分配場地] [查看賽程]      │
│         ↑ 按當前分類重新分配       │
└────────────────────────────────────┘
```

## 🔧 智能分配邏輯（已實施）

### 小組賽：按小組固定場地
```typescript
Group A 所有比賽 → Court 01
Group B 所有比賽 → Court 02
Group C 所有比賽 → Court 03
Group D 所有比賽 → Court 01（循環）
```

**優點**：
- 觀眾跟隨方便（固定在一個場地看完一個小組）
- 選手方便（知道自己的場地）
- 轉播方便（固定機位拍攝一個小組）

### 淘汰賽：按輪次 + 主場地優先
```typescript
決賽（FI）→ Court 01（主場地）✨
季軍賽（3RD）→ Court 01
準決賽（SF）→ Court 01
八強（QF）→ Court 01, 02, 03, 01（輪流）
16 強（R16）→ Court 01, 02, 03...（輪流）
```

**優點**：
- 重要比賽集中在主場地（儀式感）
- 初輪充分利用所有場地（效率）
- 符合國際標準賽制

## 🔄 完整工作流程

### 場景 1：標準流程

```
1. 場地管理 Tab
   - 新增 Court 01, 02, 03

2. 賽程管理 Tab → [男子雙打]
   - 選擇方案 → 發布賽程
   - 系統自動智能分配場地 ✅
   
結果（4 組小組賽）：
  Group A → Court 01（10 場）
  Group B → Court 02（10 場）
  Group C → Court 03（10 場）
  Group D → Court 01（10 場）
  QF → 輪流分配
  SF/FI → Court 01（主場地）
```

### 場景 2：事後新增場地

```
初始：2 個場地
發布賽程：男子雙打

後來：新增 Court 03, 04
  ↓
賽程管理 Tab → [男子雙打]
  ↓
點擊「🔄 重新分配場地」
  ↓
✅ 此分類的比賽重新分配到 4 個場地

效果：
  Group A → Court 01
  Group B → Court 02
  Group C → Court 03
  Group D → Court 04（更均勻）
```

### 場景 3：多分類獨立管理

```
男子雙打（20 組，4 組小組賽）：
  - 已發布
  - 點擊「重新分配」
  - 只影響男子雙打的比賽 ✅

女子單打（16 人，純淘汰）：
  - 已發布
  - 點擊「重新分配」
  - 只影響女子單打的比賽 ✅

→ 各分類獨立，互不影響
```

## 📊 分配策略詳解

### 策略優先級

1. **小組賽優先按小組** ⭐
   ```
   為什麼？
   - 小組內比賽密集（循環賽）
   - 固定場地方便觀眾跟隨
   - 選手熟悉場地
   ```

2. **決賽系列優先主場地** ⭐
   ```
   為什麼？
   - 決賽是最重要的比賽
   - 集中觀眾和資源
   - 增加儀式感
   - 符合國際標準
   ```

3. **初輪充分利用場地** ⭐
   ```
   為什麼？
   - 初輪比賽多
   - 需要同時進行
   - 縮短賽程時間
   ```

### 實際案例

**20 組參賽，4 組小組賽 → 8 強淘汰（3 個場地）**：

```
小組賽（40 場）：
  Group A（10 場）→ Court 01
  Group B（10 場）→ Court 02
  Group C（10 場）→ Court 03
  Group D（10 場）→ Court 01

淘汰賽（7 場）：
  QF（4 場）→ Court 01, 02, 03, 01
  SF（2 場）→ Court 01
  FI（1 場）→ Court 01

觀眾體驗：
  - 想看 Group A → 去 Court 01
  - 想看 Group B → 去 Court 02
  - 想看決賽 → 去 Court 01（主場地）
```

## 📋 修改清單

### 修改文件（3 個）

1. **bracketService.ts** ✅
   - 重寫 `assignCourtsToMatches`
   - 新增 `assignGroupStageCourts`（按小組）
   - 新增 `assignKnockoutCourts`（按輪次）

2. **courtService.ts** ✅
   - 修改 `reassignCourts`（全局，保留）
   - 新增 `reassignCourtsByCategory`（按分類）⭐
   - 使用相同的智能策略

3. **CategoryScheduleManager.tsx** ✅
   - 添加「重新分配場地」按鈕
   - 添加 `handleReassignCourts` 函數
   - 只影響當前分類

4. **CourtManager.tsx** ✅
   - 移除重新分配按鈕
   - 更新提示文字

## 🎯 功能對照

| 功能 | 位置 | 範圍 | 狀態 |
|------|------|------|------|
| 新增場地 | 場地管理 Tab | 全局 | ✅ |
| 刪除場地 | 場地管理 Tab | 全局 | ✅ |
| 智能分配（發布時）| 賽程管理 Tab | 按分類 | ✅ |
| 重新分配 | 賽程管理 Tab | 按分類 | ✅⭐ |

## ✅ 測試檢查清單

### 智能分配邏輯
- [x] 小組賽按小組固定場地
- [x] 淘汰賽決賽在 Court 01
- [x] 準決賽在 Court 01
- [x] 八強輪流分配
- [x] 日誌輸出正確

### 重新分配功能
- [x] 按鈕在賽程管理 Tab
- [x] 按鈕在已發布狀態顯示
- [x] 只影響當前分類
- [x] 確認對話框說明清楚
- [x] 結果回報詳細
- [x] 沒有場地時禁用

## 🎊 完成

**場地分配已優化為專業級智能策略！**

- ✅ 小組賽：按小組固定場地
- ✅ 淘汰賽：決賽在主場地
- ✅ 初輪：充分利用場地
- ✅ 重新分配：按分類獨立
- ✅ 符合國際標準
- ✅ 優秀的觀眾體驗

**場地管理功能完整且專業！** 🏟️⭐

---

**實施日期**: 2024年12月21日  
**策略**: 混合智能分配  
**狀態**: ✅ 最終完成

