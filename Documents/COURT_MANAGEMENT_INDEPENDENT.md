# 場地管理獨立化

## 🎯 改進內容

### 1. 場地管理獨立為 Tab ⭐

**改動**：
```
舊：賽程管理 Tab 內部
  ├─ 場地管理（嵌入）
  └─ 分類發布

新：獨立的 Tab
  ├─ 賽事資訊
  ├─ 選手管理
  ├─ 紀錄員管理
  ├─ 場地管理 ⭐ 獨立
  └─ 賽程管理
```

**優點**：
- ✅ 更清晰的結構
- ✅ 場地管理更顯眼
- ✅ 避免賽程管理 Tab 過於擁擠

### 2. 發布賽程前檢查場地 ⭐

**新增驗證**：
```typescript
if (courts.length === 0) {
  setError("請先在「場地管理」Tab 新增至少一個場地");
  return;  // 阻止發布
}
```

**效果**：
- ✅ 強制主辦方先設定場地
- ✅ 避免發布後沒有場地可用
- ✅ 提供明確的錯誤提示

## 🎨 UI 效果

### 主辦方控制台 Tab 結構（最終版）

```
┌─────────────────────────────────────────┐
│ [賽事資訊] [選手管理] [紀錄員管理]     │
│ [場地管理] [賽程管理]                   │
│     ↑ 獨立 Tab                          │
└─────────────────────────────────────────┘
```

### 場地管理 Tab

```
┌──────────────────────────────────┐
│ 場地管理            [+ 新增場地] │
├──────────────────────────────────┤
│ 💡 場地用於分配比賽。建議在發布 │
│    賽程前先設定場地。             │
├──────────────────────────────────┤
│ ┌─ Court 01 ──────────────┐     │
│ │ 空閒              [刪除] │     │
│ └──────────────────────────┘     │
│ ┌─ Court 02 ──────────────┐     │
│ │ 空閒              [刪除] │     │
│ └──────────────────────────┘     │
│ ┌─ Court 03 ──────────────┐     │
│ │ 空閒              [刪除] │     │
│ └──────────────────────────┘     │
├──────────────────────────────────┤
│ 共 3 個場地                      │
└──────────────────────────────────┘
```

### 賽程管理 Tab（發布時檢查）

```
┌──────────────────────────────────┐
│ [男子雙打] [女子單打]           │
│    ↑ 選中                        │
├──────────────────────────────────┤
│ 賽程發布                         │
│ 參賽者：18  場地：3  賽制：小組  │
├──────────────────────────────────┤
│ 智能推薦方案...                  │
│                                  │
│ [發布賽程]                       │
└──────────────────────────────────┘

如果沒有場地：
┌──────────────────────────────────┐
│ ❌ 請先在「場地管理」Tab 新增至少 │
│    一個場地                      │
└──────────────────────────────────┘
```

## 🔄 完整工作流程（最終版）

### 主辦方操作順序

```
1. 賽事資訊 Tab
   - 查看資訊
   - 開放報名

2. 選手管理 Tab
   - 審核報名
   - 手動新增
   - 生成測試數據

3. 紀錄員管理 Tab
   - 邀請紀錄員

4. 【場地管理 Tab】⭐ 重要
   - 新增 Court 01
   - 新增 Court 02
   - 新增 Court 03
   ↓ 至少需要 1 個場地

5. 賽程管理 Tab
   - 選擇分類
   - 選擇方案
   - 發布賽程 ← 會檢查場地
   ↓
系統自動分配場地給第一輪比賽 ✅
```

## 📊 場地檢查邏輯

### 發布賽程驗證

```typescript
// 1. 參賽者檢查
if (participants.length < 2) {
  return "至少需要 2 位參賽者";
}

// 2. 場地檢查 ⭐ 新增
if (courts.length === 0) {
  return "請先在「場地管理」Tab 新增至少一個場地";
}

// 3. 分組方案檢查（小組賽）
if (category.format === "GROUP_THEN_KNOCKOUT" && !selectedConfig) {
  if (suggestedConfigs.length > 0) {
    return "請選擇分組方案";
  }
  // 自動降級為純淘汰
}

// 4. 執行發布
await generateKnockoutOnly(...);
// 或
await generateGroupThenKnockout(...);
```

### 場地分配

```typescript
// bracketService.ts
assignCourtsToMatches(firstRoundMatches, courts);

// 輪流分配
matchesNeedingCourts.forEach((match, index) => {
  const court = courts[index % courts.length];
  match.courtId = court.id;
  match.status = "SCHEDULED";
});
```

## 💡 用戶引導

### 錯誤提示優化

**場地不足時**：
```
❌ 請先在「場地管理」Tab 新增至少一個場地

建議：
- 小型賽事（< 16 人）：2-3 個場地
- 中型賽事（16-32 人）：3-5 個場地
- 大型賽事（> 32 人）：5-8 個場地
```

**提示位置**：
- 賽程發布按鈕上方（紅色錯誤訊息）
- 阻止發布操作

## 🎯 Tab 結構（最終版）

### 主辦方控制台 - 5 個 Tab

| Tab | 功能 | 主要操作 |
|-----|------|----------|
| 1. 賽事資訊 | 基本資訊、狀態轉換 | 編輯、開放報名、截止報名 |
| 2. 選手管理 | 按分類管理參賽者 | 批准、婉拒、手動新增、測試數據 |
| 3. 紀錄員管理 | 按分類查看紀錄員 | 邀請、移除 |
| 4. 場地管理 ⭐ | 場地 CRUD | 新增、刪除場地 |
| 5. 賽程管理 | 按分類發布賽程 | 智能推薦、發布（需要場地）|

## 📋 修改清單

### 修改文件（2 個）
- ✅ `src/pages/organizer/TournamentDashboard.tsx`
  - Tabs 新增「場地管理」
  - 場地管理移到獨立 Tab
  - 賽程管理移除場地區塊

- ✅ `src/components/features/CategoryPublisher.tsx`
  - 添加場地數量檢查
  - 優化錯誤提示

### 樣式調整
- ✅ `CourtManager.module.scss`
  - 移除 margin（獨立 Tab 不需要）

## ✅ 功能檢查清單

### 場地管理
- [x] 獨立 Tab 顯示
- [x] 新增場地
- [x] 刪除場地
- [x] 顯示場地列表
- [x] 顯示場地狀態

### 賽程發布
- [x] 檢查參賽者數量
- [x] 檢查場地數量 ⭐
- [x] 檢查分組方案（如需要）
- [x] 自動分配場地
- [x] 清晰的錯誤提示

## 🎯 使用流程

### 推薦順序

```
Step 1：設定基本資訊
  → 賽事資訊 Tab

Step 2：開放報名
  → 賽事資訊 Tab → 開放報名

Step 3：管理報名
  → 選手管理 Tab → 批准參賽者

Step 4：邀請紀錄員
  → 紀錄員管理 Tab → 邀請

Step 5：設定場地 ⭐ 重要
  → 場地管理 Tab → 新增場地（至少 1 個）

Step 6：發布賽程
  → 賽程管理 Tab → 選擇方案 → 發布

Step 7：進行比賽
  → 紀錄員記分 → 自動晉級
```

## 🎊 完成

**場地管理已獨立並添加發布前檢查！**

- ✅ 場地管理獨立為 Tab
- ✅ 結構更清晰
- ✅ 發布前強制檢查場地
- ✅ 清晰的錯誤提示
- ✅ 引導用戶正確操作順序

**流程更順暢，操作更安全！** 🏟️✅

---

**修改日期**: 2024年12月21日  
**狀態**: ✅ 已完成  
**Tab 數量**: 5 個

